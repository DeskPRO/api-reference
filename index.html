<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;shell&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <div style="text-align: center; margin: 5px;">
        <img src="images/logo.png" />
      </div>
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="getting-started">Getting Started</h1>

<p>The DeskPRO API is a REST-based API that runs over HTTP(S). All API requests are made to a URL that begins with
<code class="prettyprint">http://example.com/api/v2/</code>.</p>

<p>Since all API requests are simply HTTP requests, it&rsquo;s easy to use in any programming
language. For the purposes of demonstration, we&rsquo;ll use cURL in our examples here.</p>

<p>Here&rsquo;s an exmaple call made to the <code class="prettyprint">helpdesk/discover</code> endpoint:</p>
<pre class="highlight shell"><code>curl http://example.com/api/v2/helpdesk/discover
</code></pre>

<blockquote>
<p>Example response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"is_deskpro"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"helpdesk_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https:\/\/example.com\/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"base_api_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https:\/\/example.com\/api\/v2\/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"build"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1477995658"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"linked"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h2 id="authentication">Authentication</h2>

<p>The above example is one of the few API endpoints that is public. Almost every API endpoint in DeskPRO that
is actually useful requires authentication. The most common way to use the API is via an API key. An admin can
create keys from Admin &gt; Apps &gt; API Keys.</p>

<p>To authenticate an API request, you send an Authorization header like <code class="prettyprint">Authorization: key YOURKEY</code>. Your API key
will be an integer, followed by a colon, followed by a long random string of characters.</p>

<blockquote>
<p>Example request to the /me endpoint to see info about the agent the key is assigned to:</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: key 2:YWK2PGCS8CNW62SR8TBTBKWMY"</span> http://example.com/api/v2/me
</code></pre>

<blockquote>
<p>Example response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"auth_method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"api_key"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"app_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nt">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"person"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"linked"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h2 id="request-format">Request Format</h2>

<p>The DeskPRO API is completely JSON.</p>

<ul>
<li>You SHOULD send a <code class="prettyprint">Accept: application/json</code> to confirm that your app is expecting JSON back from the API.</li>
<li>You MUST send <code class="prettyprint">POST/PUT</code> requests with a <code class="prettyprint">Content-Type: application/json</code> header and send a well-formed JSON payload.</li>
</ul>

<h3 id="http-verbs">HTTP Verbs</h3>

<p>The HTTP verb you use is meaningful. Here&rsquo;s a summary of the HTTP verbs you can use with the DeskPRO API and what they mean:</p>

<table><thead>
<tr>
<th>Verb</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead><tbody>
<tr>
<td>GET</td>
<td>Get a single resource or collection</td>
<td>GET /tickets or GET /tickets/13</td>
</tr>
<tr>
<td>DELETE</td>
<td>Delete a single resource</td>
<td>DELETE /ticket/13</td>
</tr>
<tr>
<td>PUT</td>
<td>Create something new</td>
<td>PUT /tickets</td>
</tr>
<tr>
<td>POST</td>
<td>Update an existing resource</td>
<td>POST /tickets/13</td>
</tr>
</tbody></table>

<h2 id="response-format">Response Format</h2>

<p>When you perform a <code class="prettyprint">GET</code> request to load a resource or a collection, you&rsquo;ll get a response like this. </p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<ul>
<li><code class="prettyprint">data</code> is the JSON representation of the resource requested, or an array of objects if you requested a collection</li>
<li><code class="prettyprint">links</code> optional; when specified, it is an array of useful links. Resource collections always include links for “next”, “prev”, “first”, “last”.</li>
<li><code class="prettyprint">meta</code> optional; misc information that varies based on endpoint. Resource collections should include “count”, “total_count*, “page”, “total_pages”.</li>
</ul>

<h3 id="collection-responses">Collection Responses</h3>

<p>During a resource collection request, you can specify the following optional query parameters:</p>

<ul>
<li><code class="prettyprint">count</code> the number of results to return</li>
<li><code class="prettyprint">page</code>the page you are requesting</li>
</ul>

<p>Collection responses are always an <em>array</em>  of objects inside of <code class="prettyprint">data</code>.</p>

<p><code class="prettyprint">links</code> will contain some useful links to help you paginate:</p>

<ul>
<li><code class="prettyprint">next</code> URL to the next page of results</li>
<li><code class="prettyprint">prev</code> URL to the previous page of results</li>
<li><code class="prettyprint">self</code> URL to the page you requested</li>
<li><code class="prettyprint">first</code> URL to the first page of results</li>
<li><code class="prettyprint">last</code> URL to the last page of results</li>
</ul>

<p><code class="prettyprint">meta</code> will contain some useful data:</p>

<ul>
<li><code class="prettyprint">total</code> is the total count (all matching resources)</li>
<li><code class="prettyprint">page</code> is current page number</li>
<li><code class="prettyprint">per_page</code> is a count of the number of resources returned to you on this page</li>
<li><code class="prettyprint">total_pages</code> is the total number of pages for this request</li>
</ul>

<blockquote>
<p>Example request to /tickets which is a collection resource:</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: key 2:YWK2PGCS8CNW62SR8TBTBKWMY"</span> http://example.com/api/v2/tickets
</code></pre>

<blockquote>
<p>Example response of a collection resource</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
   </span><span class="nt">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"first"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/tickets"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/tickets?page=2"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"prev"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nt">"last"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/tickets?page=106"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="err">{</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
        </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Foo Bar"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="err">{</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nt">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
        </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Fizz Buzz"</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="err">},</span><span class="w">
   </span><span class="s2">"meta"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">5445</span><span class="p">,</span><span class="w">
      </span><span class="nt">"page"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nt">"per_page"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
      </span><span class="nt">"total_pages"</span><span class="p">:</span><span class="w"> </span><span class="mi">545</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>

<h3 id="creating-and-updating-content">Creating and Updating Content</h3>

<p>When you update a resource with <code class="prettyprint">POST</code>, the API will simply return a <code class="prettyprint">204 No Content</code> empty response to ackknowledge that
the request succeeded. When you create a resource with a <code class="prettyprint">PUT</code> request, the API will return a <code class="prettyprint">201 Created</code> response.</p>

<p>In both cases, a <code class="prettyprint">Location</code> header will be supplied with the full URL to the API endpoint where
you can <code class="prettyprint">GET</code> the resource.</p>

<p>TIP: If you would rather your <code class="prettyprint">POST/PUT</code> request return the full resource automatically (i.e. you want to use it right away),
you can submit your request with the <code class="prettyprint">?follow_location=1</code> query string parameter. This will cause the API
to return the resource as if you did the GET yourself.</p>

<h3 id="error-responses">Error Responses</h3>

<p>Error responses are also JSON and follow the shape described here.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="w">
    </span><span class="s2">"code"</span><span class="err">:</span><span class="w"> </span><span class="s2">"invalid_json_body"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Invalid JSON body"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<ul>
<li>The <code class="prettyprint">status</code> will be the HTTP status code that most closely matches the error.</li>
<li>The <code class="prettyprint">code</code> is a DeskPRO specific string to represent the specific error that happened. You may
wish to use this value in your code in an if/switch etc to base your error handling on.</li>
<li>The <code class="prettyprint">message</code> is a human-readable English string that describes what went wrong. This value is typcially
only useful for developers.</li>
</ul>

<h4 id="details-errors">Details Errors</h4>

<p>In some cases, detailed error messages are available, such as when there are form validation errors.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w">
    </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid_input"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Request input is invalid."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"extra_fields"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Unexpected field names: name"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"required"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This value should not be blank."</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"date"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                  </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid_date"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This date is invalid"</span><span class="w">
                  </span><span class="p">}</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="nt">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="nt">"day"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                      </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                          </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"out_of_range"</span><span class="p">,</span><span class="w">
                          </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Must be a number between 1 and 31"</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                      </span><span class="p">]</span><span class="w">
                  </span><span class="p">},</span><span class="w">
                  </span><span class="nt">"year"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                      </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"required"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This value is required"</span><span class="w">
                      </span><span class="p">}</span><span class="w">
                    </span><span class="p">]</span><span class="w">
                  </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The root <code class="prettyprint">errors</code> property is an object that has two properties:</p>

<ul>
<li><code class="prettyprint">errors.errors</code> is a JSON array of error objects that happened on a global level (not specific to any one input).</li>
<li><code class="prettyprint">errors.fields</code> is a JSON object that has a property for every expected input name that had an error.
Inside of each field is a property named “errors” which is an array of error objects (code/message).</li>
</ul>

<h3 id="common-http-status-codes">Common HTTP Status Codes</h3>

<p>The HTTP status codes that the API returns is significant. Here is a list of common return codes.</p>

<table><thead>
<tr>
<th>Code</th>
<th>Verbs</th>
<th>Example</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>GET</td>
<td>found and returned</td>
</tr>
<tr>
<td>404</td>
<td>Any</td>
<td>resource not found</td>
</tr>
<tr>
<td>201</td>
<td>POST</td>
<td>created resource</td>
</tr>
<tr>
<td>204</td>
<td>PUT</td>
<td>updated resource</td>
</tr>
<tr>
<td>400</td>
<td>Any</td>
<td>Bad Request</td>
</tr>
<tr>
<td>401</td>
<td>Any</td>
<td>unauthorized</td>
</tr>
<tr>
<td>403</td>
<td>Any</td>
<td>forbidden</td>
</tr>
<tr>
<td>405</td>
<td>Any</td>
<td>method not allowed</td>
</tr>
<tr>
<td>429</td>
<td>Any</td>
<td>too many requests</td>
</tr>
<tr>
<td>423</td>
<td>Any</td>
<td>Locked</td>
</tr>
</tbody></table>

<h2 id="api-key-limits">API Key Limits</h2>

<p>You can specify API limits on every API key you create. For example, it is not uncommon to set an upper limit on
an API key to prevent some kind of mistake in it&rsquo;s use (such as a flood or infinite loop situation). You can define
these limits in terms of an hourly limit or a daily limit.</p>

<p>For cloud customers, there is also default global limit to prevent abuse. You can raise this on request by contacting
 us at support@deskpro.com.</p>

<p>When you hit a rate limit, requests will begin to fail with a HTTP status code <code class="prettyprint">429 Too Many Requests</code> error.</p>

<h1 id="api-token-exchange">API Token Exchange</h1>

<p>You can also use the API to exchange an agent login for an API token which can be used to authenticate requests.
An API token is similar to an API key except that it doesn&rsquo;t need to be created by an admin. It&rsquo;s created
by the system when given a successful set of credentials.</p>

<p>A token is used in the same way except the Authorzation header looks like <code class="prettyprint">Authorization: token YOURTOKEN</code>. This is
the same as the API key method except it starts with the word &ldquo;token&rdquo; instead of &ldquo;key&rdquo;.</p>

<blockquote>
<p>Example request sending login credentials</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
     -X POST <span class="se">\</span>
     -d <span class="s1">'{"email": "user@example.com", "password": "my_password"}'</span>
     http://example.com/api/v2/api_tokens
</code></pre>

<blockquote>
<p>Example response with an API token</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"18:BZWWGQ58QDX8H5B4W4RAJ978Q"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"linked"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>The /me endpoint returns info about the agent account the token/api key is for</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: token 18:BZWWGQ58QDX8H5B4W4RAJ978Q"</span> http://example.com/api/v2/me
</code></pre>

<blockquote>
<p>Example response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"auth_method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"api_token"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"app_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nt">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"person"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"linked"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h2 id="external-authentication-sources">External Authentication Sources</h2>

<p>The above example works for DeskPRO-based logins or form-based logins where a username/email address
and password can be gathered from the user and then passed directly to the API for validation. But it does
NOT work for other types of authentication apps such as JWT, SAML, oAuth, etc.</p>

<p>For these types of apps, you need to render a website with a special URL for the user to log in to. When the user
finishes logging in, they are redirect back to DeskPRO which can then communicate the changes up to your app
through Javascript.</p>

<h3 id="get-a-list-of-usersources">Get a list of usersources</h3>

<p>Typically, the first step in your app will be to get a list of usersources that exist so you can render
some kind of button.</p>

<blockquote>
<p>Request user sources used for agents:</p>
</blockquote>
<pre class="highlight plaintext"><code>curl http://example.com/api/v2/api_tokens/user_sources/agent
</code></pre>

<blockquote>
<p>Example response including a Google+ user source:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
            </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Google+ Sign-In"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"agent"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"source_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"googleplus"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"display_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"social"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"display_order"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nt">"display_options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"login_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http:\/\/master.dp.devput.com:8080\/api\/v2\/api_tokens\/user_sources\/5\/login?format=default"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"is_enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"linked"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="handling-the-login">Handling the login</h3>

<p>In your app, you would render a button that loaded the URL in the <code class="prettyprint">data.display_options.login_url</code> field. In a web app,
this might be rendering an <code class="prettyprint">&lt;a&gt;</code> tag for example. In a desktop or mobile application, you would initialise a new
web view to accept te login.</p>

<p>After the user logs in, they are returned to DeskPRO which renders a special page like this:</p>
<pre class="highlight html"><code><span class="nt">&lt;script&gt;</span><span class="nx">sendPayload</span><span class="p">({</span>
    <span class="s2">"token"</span><span class="p">:</span> <span class="s2">"18:BZWWGQ58QDX8H5B4W4RAJ978Q"</span><span class="p">,</span>
    <span class="s2">"person_id"</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">})</span><span class="nt">&lt;/script&gt;</span>
</code></pre>

<p>Your app will need to make sure the web view implements this special <code class="prettyprint">sendPayload</code> function so it can accept the
Javascript object.</p>

<h1 id="batch-requests">Batch Requests</h1>

<p>Sometimes you want to perform multiple queries all at once. For example, maybe you need to load a few collections
to populate a form. Normally you would need to submit multiple HTTP requests which could be slow.</p>

<blockquote>
<p>Example request using a key-value map of requests to execute in a batch:</p>
</blockquote>
<pre class="highlight shell"><code>curl -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
     -X POST <span class="se">\</span>
     -d <span class="s1">'
 {
     "t": {
         "method": "POST",
         "url": "/api/tickets",
         "payload": {
             "title": "new-ticket"
         }
    },
    "john": "/api/people/1",
    "img": "/api/people/1/image",
    "parts": "/api/tickets/5/participants"
 }
'</span>
     http://example.com/api/v2/batch
</code></pre>

<blockquote>
<p>Example response where each response uses the same key you sent in the request:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"t"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"response_code"</span><span class="p">:</span><span class="w"> </span><span class="mi">201</span><span class="p">,</span><span class="w">

      </span><span class="err">}</span><span class="p">,</span><span class="w">
      </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"new-ticket"</span><span class="w">
         </span><span class="s2">"..."</span><span class="err">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"john"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"response_code"</span><span class="p">:</span><span class="w"> </span><span class="mi">404</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>You POST a map to <code class="prettyprint">/api/v2/batch</code> describing the requests you want to submit. The system will process all of your reuqests
at once, and send you back a single result object. The keys of the result will be the same keys you submitted.</p>

<h2 id="short-get-syntax">Short GET Syntax</h2>

<p>You can also use the short GET syntax to process multiple GET requests all at once:</p>
<pre class="highlight shell"><code>curl -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    http://example.com/api/v2/batch/api/v2/batch?get[stars]<span class="o">=</span>/api/v2/ticket_stars&amp;get[departments]<span class="o">=</span>/api/v2/ticket_departments
</code></pre>

<h1 id="side-loading">Side Loading</h1>

<p>A normal request for a resource usually includes IDs of related resources, like so:</p>

<h1 id="access-control">Access Control</h1>

<p>Every API request is performed in the context of a specific agent or admin in the system. When you create an API key,
you specify the agent account it is tied to. You can never do anything with the API that the agent/admin account
would not be able to do itself through the web interface.</p>

<p>For example, say you made an API key for John. Using that API key, you could not view, reply, delete etc a ticket
that John himself doesn&rsquo;t already have access to.</p>

<p>This means if you needed some kind of &ldquo;super&rdquo; API key that could do <em>everything</em>, you would need to make sure the
agent that key was tied to had full permissions in the helpdesk.</p>

<h2 id="access-control-via-tags">Access control via Tags</h2>

<p>Every API endpoint in the system has one or more &ldquo;tags&rdquo; associated with it. You can view the tags for a particular
endpoint by finding it in the <a href="/api/v2/doc">Full API Browser</a>. Expand the API endpoint to view the details, and
under the &ldquo;API tags for this endpoint&rdquo; heading will be the list of tags applied to the endpoint.</p>

<p>For example, <code class="prettyprint">GET /api/v2/tickets</code> has a tag of <code class="prettyprint">tickets.tickets.list</code>. And <code class="prettyprint">DELETE /api/v2/tickets/{id}</code>
has a tag of <code class="prettyprint">tickets.tickets.delete</code>.</p>

<p>You can fine-tune access to API endpoitns by specificying a tag pattern when you define the API key in
Admin &gt; Apps &gt; API Keys. In the &ldquo;Tags&rdquo; tab, enter one or more tags you want to allow access to.</p>

<p>You can use wildcards to whitelist a whole group of related tags (indeed, the default value for API keys
is to allow <em>all</em> API endpoints so the value is <code class="prettyprint">*</code>). You can also use a minus symbol to <em>remove</em> specific
actions you don&rsquo;t want to allow.</p>

<p>Examples:</p>

<ul>
<li><code class="prettyprint">*</code> all API endpoints</li>
<li><code class="prettyprint">*, -tickets.*</code> all API endpoints except tickets</li>
<li><code class="prettyprint">tickets.*, -*.delete</code>&rsquo; ticket endpoints but nothing to do with deleting</li>
<li><code class="prettyprint">tickets.tickets.list</code> only allow using the ticket listing API</li>
</ul>

<h2 id="api-access-modes">API Access Modes</h2>

<p>Most of the time, most APIs are available to any authenticated user of the API. But some APIs are locked down
so they cannot be used except by users accessing the API by a specific method.</p>

<p>You can view these limitations on each endpoint by viewing the <a href="/api/v2/doc">Full API Browser</a>. In an expanded
node for an endpoint, notice the value for &ldquo;Applicable API Modes&rdquo;.</p>

<ul>
<li><code class="prettyprint">key</code> is the msot common and means the API can be used via an API key</li>
<li><code class="prettyprint">token</code> means the API can be used by a token (see below, &ldquo;API Token Exchange&rdquo;)</li>
<li><code class="prettyprint">session</code> means that the API can be used from the browser if the agent/admin is currently logged in. These are typically
APIs used by the agent or admin interface in DeskPRO itself</li>
</ul>

<p>You almost never need to worry about this. Typically only internal APIs are marked as session or token only.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
          </div>
      </div>
    </div>
  </body>
</html>
